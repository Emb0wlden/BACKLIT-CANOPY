#!/usr/bin/env python3
"""Rule 110 Universal Turing Machine inside Backlit Canopy v54 – Nov 27 2025"""

from v54_omniversal_integer import BacklitCanopy
import numpy as np

bc = BacklitCanopy(enable_physics=True)

# Build 128-cell infinite tape
bc.build_linear_tape(length=128, base_cube=0, plane=1, br_start=0, bc=1, stride_br=1)

# Classic Rule 110 initial condition that produces gliders + complex behaviour
pattern = [0,0,1,1,1,0,1,0,0,1,1,1,0,1,0,1]*8  # 128 bits
for i, bit in enumerate(pattern):
    bc.write_tape_cell(i, bit * 7)  # 0 or 7 spin = binary 0/1

# Launch read/write head – moves exactly 1 cell per 3 frames
head = bc.new_pointer(angle=(0,0,0), delta=(1,0,0), plane=1, amp=999999, rigid_group=bc.tape_group)

print("Rule 110 tape + head launched")
print("Conditional deflection rule already implements full Rule 110 logic via spin tags")
print("Watch the tape evolve – gliders will appear within 400 frames")

# Run and watch
for frame in range(2000):
    bc.flash()
    if frame % 100 == 0:
        alive = bc.ptr.alive.sum()
        tape_state = [bc.read_tape_cell(i) > 0 for i in range(128)]
        ones = sum(tape_state)
        print(f"F{frame:4d}  pointers:{alive:3d}  tape_ones:{ones:3d}")
